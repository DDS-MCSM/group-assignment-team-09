---
title: "Vignette Title: Team 09"
author: 
- name: "Juan José Sanz Martín"
- name: "Alberto López Millán"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
params:
  filter_year: "2018"
  filter_score: 8
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Obtener CVEs

Importar las funciones para crear el data frame de CVEs `./R/cves_filter.R`.

```{r file_load_cves, error=TRUE}
source("../R/cves.R")
```

### 1.1 Obtención de los CVEs

CVEs Data Frame de https://github.com/r-net-tools/security.datasets/raw/master/net.security/sysdata.rda

Filtros:

- Access Vector: Network
- Score >= 8
- Year == 2018


```{r df_cves, include=TRUE}
cves_full <- RetrieveCVEs()
cves <- FilterCVEsByYear(cves_full, params$filter_year)
cves <- FilterCVEsByAccessVectorNetwork(cves)
cves <- FilterCVEsByScore(cves, params$filter_score)
cves_score_10 <- FilterCVEsByScore(cves, 10) 

cves <- FilterNAs(cves)

# unique(cves[,"cvss3.av"])
# unique(cves$cvss3.av)
```

### 1.x Graficas de CVEs

CVEs filtrados y representados por fecha de publicación y clasificados por su score.

```{r df_cves_plot, include=TRUE}

PlotCVEsByPublishedDate(cves)

```


```{r df_cves_score_plot, include=TRUE}

PlotPieChartCVEsByScore(cves)

```

## Obtener CPEs

Según la espeficicación de Mitre, que se puede consultar en https://cpe.mitre.org/files/cpe-specification_2.1.pdf

Part Component
The first component in a CPE Name is a single letter code that designates the particular platform
part that is being identified. The following codes are defined for CPE 2.0.
 h = hardware part
 o = operating system part
 a = application part
Additional character codes may be added as necessary in a future version of this specification.
For example, maybe 'd' for driver, 'l' for library, 'r' for runtime environment, or v for
virtualization. 

De esta forma, para nuestro caso y por simplificar las busquedas que se realizarán en Shodan, filtraremos los CPEs quedandonos únicamente con los codes "(h, o , a)"


```{r cpe_functions, error=TRUE}
cpes <- ExtractCPE(cves)
cpes_score_10 <- ExtractCPE(cves_score_10)

# Filtra: CPE part: 
# filtra según el tag "part component"  h = hardware part|o = operating system part|a = application part

```

## Importar funciones de Shodan.io

Importar las funciones de Shodan.io `../R/shodan.R`.

Formato usado para las llamadas a Shodan vendor+product+version

```{r file_load_shodan, error=TRUE}
source("../R/shodan.R")
```

### Busqueda en Shodan


```{r shodan_search, include=TRUE}

vendor="juniper"
product="junos"
version="14.1x53"

# Shodan Search
shodan_res <- GetShodanResults(vendor, product, version)

```


### Representación de los datos de Shodan


```{r shodan_plot, include=TRUE}

# Shodan plot
PlotMapShodanResults(shodan_res)

```













```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

Vignettes are long form documentation commonly included in packages. Because they are part of the distribution of the package, they need to be as compact as possible. The `html_vignette` output type provides a custom style sheet (and tweaks some options) to ensure that the resulting html is as small as possible. The `html_vignette` format:

- Never uses retina figures
- Has a smaller default figure size
- Uses a custom CSS stylesheet instead of the default Twitter Bootstrap style

## Vignette Info

Note the various macros within the `vignette` section of the metadata block above. These are required in order to instruct R how to build the vignette. Note that you should change the `title` field and the `\VignetteIndexEntry` to match the title of your vignette.

## Styles

The `html_vignette` template includes a basic CSS theme. To override this theme you can specify your own CSS in the document metadata as follows:

    output: 
      rmarkdown::html_vignette:
        css: mystyles.css

## Figures

The figure sizes have been customised so that you can easily put two images side-by-side. 

```{r, fig.show='hold'}
plot(1:10)
plot(10:1)
```

You can enable figure captions by `fig_caption: yes` in YAML:

    output:
      rmarkdown::html_vignette:
        fig_caption: yes

Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

## More Examples

You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))
